
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Equivalent layer for griding and upward-continuing gravity data &#8212; Fatiando dev</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/font-awesome/css/font-awesome.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     'ac2afbcb2d99b18f145cc1ed40075beb5f92dd5a',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Euler deconvolution with a moving window" href="euler_moving_window.html" />
    <link rel="prev" title="Forward modeling magnetic data using spheres in Cartesian coordinates" href="forward_modeling_sphere_mag.html" />

    
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">


    <meta name="twitter:card" content="summary">
    <meta name="twitter:image" content="http://www.fatiando.org/_static/fatiando-logo.png">
    <meta name="twitter:site" content="@leouieda">
    <meta name="twitter:title" content="Fatiando a Terra">
    <meta name="twitter:description" content="Open-source Python library for geophysics">

    <meta property="og:title" content="Fatiando a Terra">
    <meta property="og:type" content="website">
    <meta property="og:url" content="http://www.fatiando.org/">
    <meta property="og:site_name" content="Fatiando a Terra">
    <meta property="og:image" content="http://www.fatiando.org/_static/fatiando-logo.png">
    <meta property="og:description" content="Open-source Python library for geophysics">

    <!-- Google Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-38125837-1', 'auto');
    ga('send', 'pageview');
    </script>


  </head>
  <body>

    
        <div class="container-fluid" style="margin: 0px; padding: 0px;">
            <div class="alert alert-dismissible alert-warning text-center dev-version-warning">
                <button type="button" class="close" data-dismiss="alert">×</button>
                This page reflects the <strong>development version</strong>
                (<a href="https://github.com/fatiando/fatiando"><em>master</em> branch
                  on Github</a>).
                Go to <a href="http://www.fatiando.org">fatiando.org</a> for the latest
                release.
            </div>
        </div>
    

    


    
<div class="container-fluid menu text-center">
    <div class="col-lg-3 menu-brand">
        <a class="" href="../../index.html">
            
                <img src="../../_static/fatiando-navbar-logo.png">
            
            
                fatiando
            
        </a>
        <span class="menu-version">dev</span>
    </div>
    <div class="col-lg-6 menu-list">
        <ul>
            
                    <li><a href="../../install.html">Install</a></li>
                    <li><a href="../index.html">Gallery</a></li>
                    <li><a href="../../api.html">API</a></li>
                    <li><a href="../../docs.html">Docs</a></li>
                    <li><a href="../../develop.html">Contribute</a></li>
                    <li><a href="../../cite.html">Cite</a></li>
                    <li><a href="https://github.com/fatiando/fatiando"><i class="fa fa-github fa-lg" title="Source code on Github"></i></a></li>
            
        </ul>
    </div>
    <div class="col-lg-3 menu-search">
        
            
<form class="navbar-form" action="../../search.html" method="get">
    <div class="form-group">
        <input type="text" name="q" class="form-control" placeholder="Search" />
    </div>
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
</form>
        
    </div>
</div>


    

        <div class="container page-container">
            <div class="row">
                
                <div class="col-md-12 content">
                    <div class="section" id="equivalent-layer-for-griding-and-upward-continuing-gravity-data">
<span id="sphx-glr-gallery-gravmag-eqlayer-transform-py"></span><h1>Equivalent layer for griding and upward-continuing gravity data<a class="headerlink" href="#equivalent-layer-for-griding-and-upward-continuing-gravity-data" title="Permalink to this headline">¶</a></h1>
<p>The equivalent layer is one of the best methods for griding and upward
continuing gravity data and much more. The trade-off is that performing this
requires an inversion and later forward modeling, which are more time consuming
and more difficult to tune than the standard griding and FFT-based approaches.</p>
<p>This example uses the equivalent layer in <a class="reference internal" href="../../api/gravmag.eqlayer.html#module-fatiando.gravmag.eqlayer" title="fatiando.gravmag.eqlayer"><code class="xref py py-mod docutils literal"><span class="pre">fatiando.gravmag.eqlayer</span></code></a> to
grid and upward continue some gravity data. There are more advanced methods in
the module than the one we are showing here. They can be more efficient but
usually require more configuration.</p>
<img alt="../../_images/sphx_glr_eqlayer_transform_001.png" class="align-center" src="../../_images/sphx_glr_eqlayer_transform_001.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="n">Residuals</span><span class="p">:</span>
  <span class="n">mean</span><span class="p">:</span> <span class="mf">0.0246019125949</span> <span class="n">mGal</span>
  <span class="n">stddev</span><span class="p">:</span> <span class="mf">0.179200376563</span> <span class="n">mGal</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">fatiando.gravmag</span> <span class="kn">import</span> <span class="n">prism</span><span class="p">,</span> <span class="n">sphere</span>
<span class="kn">from</span> <span class="nn">fatiando.gravmag.eqlayer</span> <span class="kn">import</span> <span class="n">EQLGravity</span>
<span class="kn">from</span> <span class="nn">fatiando.inversion</span> <span class="kn">import</span> <span class="n">Damping</span>
<span class="kn">from</span> <span class="nn">fatiando</span> <span class="kn">import</span> <span class="n">gridder</span><span class="p">,</span> <span class="n">utils</span><span class="p">,</span> <span class="n">mesher</span>

<span class="c1"># First thing to do is make some synthetic data to test the method. We&#39;ll use a</span>
<span class="c1"># single prism to keep it simple</span>
<span class="n">props</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;density&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">}</span>
<span class="n">model</span> <span class="o">=</span> <span class="p">[</span><span class="n">mesher</span><span class="o">.</span><span class="n">Prism</span><span class="p">(</span><span class="o">-</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">4000</span><span class="p">,</span> <span class="n">props</span><span class="p">)]</span>

<span class="c1"># The synthetic data will be generated on a random scatter of points</span>
<span class="n">area</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">8000</span><span class="p">,</span> <span class="mi">8000</span><span class="p">,</span> <span class="o">-</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">]</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">gridder</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="c1"># Generate some noisy data from our model</span>
<span class="n">gz</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">contaminate</span><span class="p">(</span><span class="n">prism</span><span class="o">.</span><span class="n">gz</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">model</span><span class="p">),</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Now for the equivalent layer. We must setup a layer of point masses where</span>
<span class="c1"># we&#39;ll estimate a density distribution that fits our synthetic data</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">mesher</span><span class="o">.</span><span class="n">PointGrid</span><span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="c1"># Estimate the density using enough damping so that won&#39;t try to fit the error</span>
<span class="n">eql</span> <span class="o">=</span> <span class="n">EQLGravity</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">gz</span><span class="p">,</span> <span class="n">layer</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-22</span><span class="o">*</span><span class="n">Damping</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
<span class="n">eql</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="c1"># Now we add the estimated densities to our layer</span>
<span class="n">layer</span><span class="o">.</span><span class="n">addprop</span><span class="p">(</span><span class="s1">&#39;density&#39;</span><span class="p">,</span> <span class="n">eql</span><span class="o">.</span><span class="n">estimate_</span><span class="p">)</span>
<span class="c1"># and print some statistics of how well the estimated layer fits the data</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">eql</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">residuals</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Residuals:&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;  mean:&quot;</span><span class="p">,</span> <span class="n">residuals</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="s1">&#39;mGal&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;  stddev:&quot;</span><span class="p">,</span> <span class="n">residuals</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="s1">&#39;mGal&#39;</span><span class="p">)</span>

<span class="c1"># Now I can forward model gravity data anywhere we want. For interpolation, we</span>
<span class="c1"># calculate it on a grid. For upward continuation, at a greater height. We can</span>
<span class="c1"># even combine both into a single operation.</span>
<span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z2</span> <span class="o">=</span> <span class="n">gridder</span><span class="o">.</span><span class="n">regular</span><span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">z</span><span class="o">=-</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">gz_up</span> <span class="o">=</span> <span class="n">sphere</span><span class="o">.</span><span class="n">gz</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">layer</span><span class="p">)</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original data&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">tricontourf</span><span class="p">(</span><span class="n">y</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">x</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">gz</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
             <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;mGal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">x</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;xk&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;y (km)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;x (km)&#39;</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gridded and upward continued&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">tricontourf</span><span class="p">(</span><span class="n">y2</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">x2</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">gz_up</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
             <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;mGal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;y (km)&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Total running time of the script:</strong> ( 0 minutes  0.485 seconds)</p>
<div class="sphx-glr-footer docutils container">
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../../_downloads/eqlayer_transform.py" download=""><code class="xref download docutils literal"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">eqlayer_transform.py</span></code></a></div>
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../../_downloads/eqlayer_transform.ipynb" download=""><code class="xref download docutils literal"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">eqlayer_transform.ipynb</span></code></a></div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.readthedocs.io">Generated by Sphinx-Gallery</a></p>
</div>

                </div>
                  
            </div>
        </div>

    


    <footer class="footer">
        <div class="container">
            <p class="pull-right">
                <a href="#">Back to top</a>
                
                    <br/>
                    
<div id="sourcelink">
  <a href="../../_sources/gallery/gravmag/eqlayer_transform.rst.txt"
     rel="nofollow">Source</a>
</div>
                
            </p>

            <p class="text-center">
                &copy; Copyright 2010-2018, Leonardo Uieda.
                Created using <a
                    href="http://sphinx-doc.org/">Sphinx</a> 1.6.7.
            </p>
        </div>
    </footer>


  </body>
</html>