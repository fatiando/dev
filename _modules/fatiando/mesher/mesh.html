
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>fatiando.mesher.mesh &#8212; Fatiando dev</title>
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/font-awesome/css/font-awesome.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     'ac2afbcb2d99b18f145cc1ed40075beb5f92dd5a',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />

    
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">


    <meta name="twitter:card" content="summary">
    <meta name="twitter:image" content="http://www.fatiando.org/_static/fatiando-logo.png">
    <meta name="twitter:site" content="@leouieda">
    <meta name="twitter:title" content="Fatiando a Terra">
    <meta name="twitter:description" content="Open-source Python library for geophysics">

    <meta property="og:title" content="Fatiando a Terra">
    <meta property="og:type" content="website">
    <meta property="og:url" content="http://www.fatiando.org/">
    <meta property="og:site_name" content="Fatiando a Terra">
    <meta property="og:image" content="http://www.fatiando.org/_static/fatiando-logo.png">
    <meta property="og:description" content="Open-source Python library for geophysics">

    <!-- Google Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-38125837-1', 'auto');
    ga('send', 'pageview');
    </script>


  </head>
  <body>

    
        <div class="container-fluid" style="margin: 0px; padding: 0px;">
            <div class="alert alert-dismissible alert-warning text-center dev-version-warning">
                <button type="button" class="close" data-dismiss="alert">Ã—</button>
                This page reflects the <strong>development version</strong>
                (<a href="https://github.com/fatiando/fatiando"><em>master</em> branch
                  on Github</a>).
                Go to <a href="http://www.fatiando.org">fatiando.org</a> for the latest
                release.
            </div>
        </div>
    

    


    
<div class="container-fluid menu text-center">
    <div class="col-lg-3 menu-brand">
        <a class="" href="../../../index.html">
            
                <img src="../../../_static/fatiando-navbar-logo.png">
            
            
                fatiando
            
        </a>
        <span class="menu-version">dev</span>
    </div>
    <div class="col-lg-6 menu-list">
        <ul>
            
                    <li><a href="../../../install.html">Install</a></li>
                    <li><a href="../../../gallery/index.html">Gallery</a></li>
                    <li><a href="../../../api.html">API</a></li>
                    <li><a href="../../../docs.html">Docs</a></li>
                    <li><a href="../../../develop.html">Contribute</a></li>
                    <li><a href="../../../cite.html">Cite</a></li>
                    <li><a href="https://github.com/fatiando/fatiando"><i class="fa fa-github fa-lg" title="Source code on Github"></i></a></li>
            
        </ul>
    </div>
    <div class="col-lg-3 menu-search">
        
            
<form class="navbar-form" action="../../../search.html" method="get">
    <div class="form-group">
        <input type="text" name="q" class="form-control" placeholder="Search" />
    </div>
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
</form>
        
    </div>
</div>


    

        <div class="container page-container">
            <div class="row">
                
                <div class="col-md-12 content">
                    <h1>Source code for fatiando.mesher.mesh</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Meshes (collections) of geometric objects.</span>

<span class="sd">Meshes behave like lists/arrays of geometric objects (they are iterables).</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">future.builtins</span> <span class="k">import</span> <span class="nb">range</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="nb">super</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.special</span>
<span class="kn">import</span> <span class="nn">scipy.interpolate</span>
<span class="kn">import</span> <span class="nn">copy</span> <span class="k">as</span> <span class="nn">cp</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">gridder</span>
<span class="kn">from</span> <span class="nn">.geometry</span> <span class="k">import</span> <span class="n">Square</span><span class="p">,</span> <span class="n">Prism</span><span class="p">,</span> <span class="n">Sphere</span><span class="p">,</span> <span class="n">Tesseroid</span>


<div class="viewcode-block" id="SquareMesh"><a class="viewcode-back" href="../../../api/fatiando.mesher.SquareMesh.html#fatiando.mesher.SquareMesh">[docs]</a><span class="k">class</span> <span class="nc">SquareMesh</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A 2D regular mesh of squares.</span>

<span class="sd">    For all purposes, :class:`~fatiando.mesher.SquareMesh` can be used as a</span>
<span class="sd">    list of :class:`~fatiando.mesher.Square`. The order of the squares in the</span>
<span class="sd">    list is: x directions varies first, then y.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    * bounds :  list = [x1, x2, y1, y2]</span>
<span class="sd">        Boundaries of the mesh</span>
<span class="sd">    * shape : tuple = (ny, nx)</span>
<span class="sd">        Number of squares in the y and x dimension, respectively</span>
<span class="sd">    * props : dict</span>
<span class="sd">        Physical properties of each square in the mesh.</span>
<span class="sd">        Each key should be the name of a physical property. The corresponding</span>
<span class="sd">        value should be a list with the values of that particular property on</span>
<span class="sd">        each square of the mesh.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; mesh = SquareMesh((0, 4, 0, 6), (2, 2))</span>
<span class="sd">        &gt;&gt;&gt; for s in mesh:</span>
<span class="sd">        ...     print s</span>
<span class="sd">        x1:0 | x2:2 | y1:0 | y2:3</span>
<span class="sd">        x1:2 | x2:4 | y1:0 | y2:3</span>
<span class="sd">        x1:0 | x2:2 | y1:3 | y2:6</span>
<span class="sd">        x1:2 | x2:4 | y1:3 | y2:6</span>
<span class="sd">        &gt;&gt;&gt; print mesh[1]</span>
<span class="sd">        x1:2 | x2:4 | y1:0 | y2:3</span>
<span class="sd">        &gt;&gt;&gt; print mesh[-1]</span>
<span class="sd">        x1:2 | x2:4 | y1:3 | y2:6</span>

<span class="sd">    With physical properties::</span>

<span class="sd">        &gt;&gt;&gt; mesh = SquareMesh((0, 4, 0, 6), (2, 1), {&#39;slowness&#39;:[3.4, 8.6]})</span>
<span class="sd">        &gt;&gt;&gt; for s in mesh:</span>
<span class="sd">        ...     print s</span>
<span class="sd">        x1:0 | x2:4 | y1:0 | y2:3 | slowness:3.4</span>
<span class="sd">        x1:0 | x2:4 | y1:3 | y2:6 | slowness:8.6</span>

<span class="sd">    Or::</span>

<span class="sd">        &gt;&gt;&gt; mesh = SquareMesh((0, 4, 0, 6), (2, 1))</span>
<span class="sd">        &gt;&gt;&gt; mesh.addprop(&#39;slowness&#39;, [3.4, 8.6])</span>
<span class="sd">        &gt;&gt;&gt; for s in mesh:</span>
<span class="sd">        ...     print s</span>
<span class="sd">        x1:0 | x2:4 | y1:0 | y2:3 | slowness:3.4</span>
<span class="sd">        x1:0 | x2:4 | y1:3 | y2:6 | slowness:8.6</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="n">shape</span>
        <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nx</span> <span class="o">*</span> <span class="n">ny</span><span class="p">)</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">bounds</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span><span class="o">/</span><span class="n">nx</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span><span class="o">/</span><span class="n">ny</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="n">bounds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
        <span class="c1"># props has to be None, not {} by default because {} would be permanent</span>
        <span class="c1"># for all instaces of the class (like a class variable) and changes</span>
        <span class="c1"># to one instace would lead to changes in another (and a huge mess)</span>
        <span class="k">if</span> <span class="n">props</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">props</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">props</span> <span class="o">=</span> <span class="n">props</span>
        <span class="c1"># The index of the current square in an iteration. Needed when mesh is</span>
        <span class="c1"># used as an iterator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># List of masked squares. Will return None if trying to access them</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="c1"># To walk backwards in the list</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="n">index</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">index</span><span class="o">//</span><span class="n">nx</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">index</span> <span class="o">-</span> <span class="n">j</span><span class="o">*</span><span class="n">nx</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">i</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">j</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">index</span><span class="p">]]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Square</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="n">props</span><span class="o">=</span><span class="n">props</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>
        <span class="n">square</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">square</span>

<div class="viewcode-block" id="SquareMesh.addprop"><a class="viewcode-back" href="../../../api/fatiando.mesher.SquareMesh.html#fatiando.mesher.SquareMesh.addprop">[docs]</a>    <span class="k">def</span> <span class="nf">addprop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add physical property values to the cells in the mesh.</span>

<span class="sd">        Different physical properties of the mesh are stored in a dictionary.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        * prop : str</span>
<span class="sd">            Name of the physical property</span>
<span class="sd">        * values : list or array</span>
<span class="sd">            The value of this physical property in each square of the mesh.</span>
<span class="sd">            For the ordering of squares in the mesh see</span>
<span class="sd">            :class:`~fatiando.mesher.SquareMesh`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span></div>

<div class="viewcode-block" id="SquareMesh.get_xs"><a class="viewcode-back" href="../../../api/fatiando.mesher.SquareMesh.html#fatiando.mesher.SquareMesh.get_xs">[docs]</a>    <span class="k">def</span> <span class="nf">get_xs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of the x coordinates of the corners of the cells in the</span>
<span class="sd">        mesh.</span>

<span class="sd">        If the mesh has nx cells, get_xs() will return nx + 1 values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span>
        <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">==</span> <span class="n">nx</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">xs</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">==</span> <span class="n">nx</span><span class="p">:</span>
            <span class="n">xs</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">xs</span></div>

<div class="viewcode-block" id="SquareMesh.get_ys"><a class="viewcode-back" href="../../../api/fatiando.mesher.SquareMesh.html#fatiando.mesher.SquareMesh.get_ys">[docs]</a>    <span class="k">def</span> <span class="nf">get_ys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of the y coordinates of the corners of the cells in the</span>
<span class="sd">        mesh.</span>

<span class="sd">        If the mesh has ny cells, get_ys() will return ny + 1 values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span>
        <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span> <span class="o">==</span> <span class="n">ny</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ys</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span> <span class="o">==</span> <span class="n">ny</span><span class="p">:</span>
            <span class="n">ys</span> <span class="o">=</span> <span class="n">ys</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">ys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ys</span></div>

<div class="viewcode-block" id="SquareMesh.copy"><a class="viewcode-back" href="../../../api/fatiando.mesher.SquareMesh.html#fatiando.mesher.SquareMesh.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a deep copy of the current instance.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cp</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PointGrid"><a class="viewcode-back" href="../../../api/fatiando.mesher.PointGrid.html#fatiando.mesher.PointGrid">[docs]</a><span class="k">class</span> <span class="nc">PointGrid</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A regular grid of 3D point sources (spheres of unit volume).</span>

<span class="sd">    Use this as a 1D list of :class:`~fatiando.mesher.Sphere`.</span>

<span class="sd">    Grid points are ordered like a C matrix, first each row in a column, then</span>
<span class="sd">    change columns. In this case, the x direction (North-South) are the rows</span>
<span class="sd">    and y (East-West) are the columns.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    * area : list = [x1, x2, y1, y2]</span>
<span class="sd">        The area where the grid will be spread out</span>
<span class="sd">    * z : float or 1d-array</span>
<span class="sd">        The z coordinates of each point in the grid (remember, z is positive</span>
<span class="sd">        downward).</span>
<span class="sd">    * shape : tuple = (nx, ny)</span>
<span class="sd">        The number of points in the x and y directions</span>
<span class="sd">    * props :  dict</span>
<span class="sd">        Physical properties of each point in the grid.</span>
<span class="sd">        Each key should be the name of a physical property. The corresponding</span>
<span class="sd">        value should be a list with the values of that particular property for</span>
<span class="sd">        each point in the grid.</span>

<span class="sd">    Examples::</span>

<span class="sd">        &gt;&gt;&gt; g = PointGrid([0, 10, 2, 6], 200, (2, 3))</span>
<span class="sd">        &gt;&gt;&gt; g.shape</span>
<span class="sd">        (2, 3)</span>
<span class="sd">        &gt;&gt;&gt; g.size</span>
<span class="sd">        6</span>
<span class="sd">        &gt;&gt;&gt; g[0].center</span>
<span class="sd">        array([   0.,    2.,  200.])</span>
<span class="sd">        &gt;&gt;&gt; g[-1].center</span>
<span class="sd">        array([  10.,    6.,  200.])</span>
<span class="sd">        &gt;&gt;&gt; for p in g:</span>
<span class="sd">        ...     p.center</span>
<span class="sd">        array([   0.,    2.,  200.])</span>
<span class="sd">        array([   0.,    4.,  200.])</span>
<span class="sd">        array([   0.,    6.,  200.])</span>
<span class="sd">        array([  10.,    2.,  200.])</span>
<span class="sd">        array([  10.,    4.,  200.])</span>
<span class="sd">        array([  10.,    6.,  200.])</span>
<span class="sd">        &gt;&gt;&gt; g.x.reshape(g.shape)</span>
<span class="sd">        array([[  0.,   0.,   0.],</span>
<span class="sd">               [ 10.,  10.,  10.]])</span>
<span class="sd">        &gt;&gt;&gt; g.y.reshape(g.shape)</span>
<span class="sd">        array([[ 2.,  4.,  6.],</span>
<span class="sd">               [ 2.,  4.,  6.]])</span>
<span class="sd">        &gt;&gt;&gt; g.dx, g.dy</span>
<span class="sd">        (10.0, 2.0)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="n">area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span>
        <span class="k">if</span> <span class="n">props</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">props</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">props</span> <span class="o">=</span> <span class="n">props</span>
        <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">nx</span><span class="o">*</span><span class="n">ny</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="n">z</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">special</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="mf">3.</span> <span class="o">/</span> <span class="p">(</span><span class="mf">4.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">gridder</span><span class="o">.</span><span class="n">regular</span><span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
        <span class="c1"># The spacing between points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span> <span class="o">=</span> <span class="n">gridder</span><span class="o">.</span><span class="n">spacing</span><span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Invalid index type. Should be int.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="ow">or</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Grid index out of range.&#39;</span><span class="p">)</span>
        <span class="c1"># To walk backwards in the list</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="n">index</span>
        <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">index</span><span class="p">]]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">)</span>
        <span class="n">sphere</span> <span class="o">=</span> <span class="n">Sphere</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="n">props</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sphere</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>
        <span class="n">sphere</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">sphere</span>

<div class="viewcode-block" id="PointGrid.addprop"><a class="viewcode-back" href="../../../api/fatiando.mesher.PointGrid.html#fatiando.mesher.PointGrid.addprop">[docs]</a>    <span class="k">def</span> <span class="nf">addprop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add physical property values to the points in the grid.</span>

<span class="sd">        Different physical properties of the grid are stored in a dictionary.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        * prop : str</span>
<span class="sd">            Name of the physical property.</span>
<span class="sd">        * values :  list or array</span>
<span class="sd">            Value of this physical property in each point of the grid</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span></div>

<div class="viewcode-block" id="PointGrid.split"><a class="viewcode-back" href="../../../api/fatiando.mesher.PointGrid.html#fatiando.mesher.PointGrid.split">[docs]</a>    <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Divide the grid into subgrids.</span>

<span class="sd">        .. note::</span>

<span class="sd">            Remember that x is the North-South direction and y is East-West.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        * shape : tuple = (nx, ny)</span>
<span class="sd">            Number of subgrids along the x and y directions, respectively.</span>

<span class="sd">        Returns:</span>

<span class="sd">        * subgrids : list</span>
<span class="sd">            List of :class:`~fatiando.mesher.PointGrid`</span>

<span class="sd">        Examples::</span>

<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt; z = np.linspace(0, 1100, 12)</span>
<span class="sd">            &gt;&gt;&gt; g = PointGrid((0, 3, 0, 2), z, (4, 3))</span>
<span class="sd">            &gt;&gt;&gt; g.addprop(&#39;bla&#39;, [1,   2,  3,</span>
<span class="sd">            ...                   4,   5,  6,</span>
<span class="sd">            ...                   7,   8,  9,</span>
<span class="sd">            ...                   10, 11, 12])</span>
<span class="sd">            &gt;&gt;&gt; grids = g.split((2, 3))</span>
<span class="sd">            &gt;&gt;&gt; for s in grids:</span>
<span class="sd">            ...     s.props[&#39;bla&#39;]</span>
<span class="sd">            array([1, 4])</span>
<span class="sd">            array([2, 5])</span>
<span class="sd">            array([3, 6])</span>
<span class="sd">            array([ 7, 10])</span>
<span class="sd">            array([ 8, 11])</span>
<span class="sd">            array([ 9, 12])</span>
<span class="sd">            &gt;&gt;&gt; for s in grids:</span>
<span class="sd">            ...     s.x</span>
<span class="sd">            array([ 0.,  1.])</span>
<span class="sd">            array([ 0.,  1.])</span>
<span class="sd">            array([ 0.,  1.])</span>
<span class="sd">            array([ 2.,  3.])</span>
<span class="sd">            array([ 2.,  3.])</span>
<span class="sd">            array([ 2.,  3.])</span>
<span class="sd">            &gt;&gt;&gt; for s in grids:</span>
<span class="sd">            ...     s.y</span>
<span class="sd">            array([ 0.,  0.])</span>
<span class="sd">            array([ 1.,  1.])</span>
<span class="sd">            array([ 2.,  2.])</span>
<span class="sd">            array([ 0.,  0.])</span>
<span class="sd">            array([ 1.,  1.])</span>
<span class="sd">            array([ 2.,  2.])</span>
<span class="sd">            &gt;&gt;&gt; for s in grids:</span>
<span class="sd">            ...     s.z</span>
<span class="sd">            array([   0.,  300.])</span>
<span class="sd">            array([ 100.,  400.])</span>
<span class="sd">            array([ 200.,  500.])</span>
<span class="sd">            array([ 600.,  900.])</span>
<span class="sd">            array([  700.,  1000.])</span>
<span class="sd">            array([  800.,  1100.])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="n">shape</span>
        <span class="n">totalx</span><span class="p">,</span> <span class="n">totaly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="n">totalx</span> <span class="o">%</span> <span class="n">nx</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">totaly</span> <span class="o">%</span> <span class="n">ny</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Cannot split! nx and ny must be divisible by grid shape&#39;</span><span class="p">)</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">totalx</span><span class="p">)</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">totaly</span><span class="p">)</span>
        <span class="n">mx</span><span class="p">,</span> <span class="n">my</span> <span class="o">=</span> <span class="p">(</span><span class="n">totalx</span><span class="o">//</span><span class="n">nx</span><span class="p">,</span> <span class="n">totaly</span><span class="o">//</span><span class="n">ny</span><span class="p">)</span>
        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="o">*</span><span class="p">(</span><span class="n">mx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="o">*</span><span class="p">(</span><span class="n">my</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">xstart</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xs</span><span class="p">[::</span><span class="n">mx</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">ystart</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ys</span><span class="p">[::</span><span class="n">my</span><span class="p">]):</span>
                <span class="n">area</span> <span class="o">=</span> <span class="p">[</span><span class="n">xstart</span><span class="p">,</span> <span class="n">xstart</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">ystart</span><span class="p">,</span> <span class="n">ystart</span> <span class="o">+</span> <span class="n">dy</span><span class="p">]</span>
                <span class="n">props</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">:</span>
                    <span class="n">pmatrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                    <span class="n">props</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmatrix</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">mx</span><span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">mx</span><span class="p">,</span>
                                       <span class="n">j</span><span class="o">*</span><span class="n">my</span><span class="p">:(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">my</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">zmatrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                <span class="n">zs</span> <span class="o">=</span> <span class="n">zmatrix</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">mx</span><span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">mx</span><span class="p">,</span>
                             <span class="n">j</span><span class="o">*</span><span class="n">my</span><span class="p">:(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">my</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PointGrid</span><span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="n">my</span><span class="p">),</span> <span class="n">props</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">subs</span></div>

<div class="viewcode-block" id="PointGrid.copy"><a class="viewcode-back" href="../../../api/fatiando.mesher.PointGrid.html#fatiando.mesher.PointGrid.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a deep copy of the current instance.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cp</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PrismRelief"><a class="viewcode-back" href="../../../api/fatiando.mesher.PrismRelief.html#fatiando.mesher.PrismRelief">[docs]</a><span class="k">class</span> <span class="nc">PrismRelief</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A 3D model of a relief (topography) using prisms.</span>

<span class="sd">    Use to generate:</span>
<span class="sd">    * topographic model</span>
<span class="sd">    * basin model</span>
<span class="sd">    * Moho model</span>
<span class="sd">    * etc</span>

<span class="sd">    PrismRelief can used as list of prisms. It acts as an iteratior (so you</span>
<span class="sd">    can loop over prisms). It also has a ``__getitem__`` method to access</span>
<span class="sd">    individual elements in the mesh.</span>
<span class="sd">    In practice, PrismRelief should be able to be passed to any function that</span>
<span class="sd">    asks for a list of prisms, like :func:`fatiando.gravmag.prism.gz`.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    * ref : float</span>
<span class="sd">        Reference level. Prisms will have:</span>
<span class="sd">            * bottom on zref and top on z if z &gt; zref;</span>
<span class="sd">            * bottom on z and top on zref otherwise.</span>
<span class="sd">    * dims :  tuple = (dy, dx)</span>
<span class="sd">        Dimensions of the prisms in the y and x directions</span>
<span class="sd">    * nodes : list of lists = [x, y, z]</span>
<span class="sd">        Coordinates of the center of the top face of each prism.x, y, and z are</span>
<span class="sd">        lists with the x, y and z coordinates on a regular grid.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">nodes</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;nodes has x, y, z coordinate arrays of different lengths&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref</span> <span class="o">=</span> <span class="n">ref</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="n">dims</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># The index of the current prism in an iteration. Needed when mesh is</span>
        <span class="c1"># used as an iterator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="c1"># To walk backwards in the list</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="n">index</span>
        <span class="n">xc</span><span class="p">,</span> <span class="n">yc</span><span class="p">,</span> <span class="n">zc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">xc</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">xc</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">yc</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">yc</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span>
        <span class="k">if</span> <span class="n">zc</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">:</span>
            <span class="n">z1</span> <span class="o">=</span> <span class="n">zc</span>
            <span class="n">z2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span>
            <span class="n">z2</span> <span class="o">=</span> <span class="n">zc</span>
        <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">index</span><span class="p">]]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Prism</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="n">props</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>
        <span class="n">prism</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">prism</span>

<div class="viewcode-block" id="PrismRelief.addprop"><a class="viewcode-back" href="../../../api/fatiando.mesher.PrismRelief.html#fatiando.mesher.PrismRelief.addprop">[docs]</a>    <span class="k">def</span> <span class="nf">addprop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add physical property values to the prisms.</span>

<span class="sd">        .. warning:: If the z value of any point in the relief is below the</span>
<span class="sd">            reference level, its corresponding prism will have the physical</span>
<span class="sd">            property value with oposite sign than was assigned to it.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        * prop : str</span>
<span class="sd">            Name of the physical property.</span>
<span class="sd">        * values : list</span>
<span class="sd">            List or array with the value of this physical property in each</span>
<span class="sd">            prism of the relief.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">correct</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="n">v</span>
            <span class="k">return</span> <span class="n">v</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">correct</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">)]</span></div>

<div class="viewcode-block" id="PrismRelief.copy"><a class="viewcode-back" href="../../../api/fatiando.mesher.PrismRelief.html#fatiando.mesher.PrismRelief.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a deep copy of the current instance.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cp</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PrismMesh"><a class="viewcode-back" href="../../../api/fatiando.mesher.PrismMesh.html#fatiando.mesher.PrismMesh">[docs]</a><span class="k">class</span> <span class="nc">PrismMesh</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A 3D regular mesh of right rectangular prisms.</span>

<span class="sd">    Prisms are ordered as follows: first layers (z coordinate),</span>
<span class="sd">    then EW rows (y) and finaly x coordinate (NS).</span>

<span class="sd">    .. note:: Remember that the coordinate system is x-&gt;North, y-&gt;East and</span>
<span class="sd">        z-&gt;Down</span>

<span class="sd">    Ex: in a mesh with shape ``(3,3,3)`` the 15th element (index 14) has z</span>
<span class="sd">    index 1 (second layer), y index 1 (second row), and x index 2 (third</span>
<span class="sd">    element in the column).</span>

<span class="sd">    :class:`~fatiando.mesher.PrismMesh` can used as list of prisms. It acts</span>
<span class="sd">    as an iteratior (so you can loop over prisms). It also has a</span>
<span class="sd">    ``__getitem__`` method to access individual elements in the mesh.</span>
<span class="sd">    In practice, :class:`~fatiando.mesher.PrismMesh` should be able to be</span>
<span class="sd">    passed to any function that asks for a list of prisms, like</span>
<span class="sd">    :func:`fatiando.gravmag.prism.gz`.</span>

<span class="sd">    To make the mesh incorporate a topography, use</span>
<span class="sd">    :meth:`~fatiando.mesher.PrismMesh.carvetopo`</span>

<span class="sd">    Parameters:</span>

<span class="sd">    * bounds : list = [xmin, xmax, ymin, ymax, zmin, zmax]</span>
<span class="sd">        Boundaries of the mesh.</span>
<span class="sd">    * shape : tuple = (nz, ny, nx)</span>
<span class="sd">        Number of prisms in the x, y, and z directions.</span>
<span class="sd">    * props :  dict</span>
<span class="sd">        Physical properties of each prism in the mesh.</span>
<span class="sd">        Each key should be the name of a physical property. The corresponding</span>
<span class="sd">        value should be a list with the values of that particular property on</span>
<span class="sd">        each prism of the mesh.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from fatiando.mesher import PrismMesh</span>
<span class="sd">        &gt;&gt;&gt; mesh = PrismMesh((0, 1, 0, 2, 0, 3), (1, 2, 2))</span>
<span class="sd">        &gt;&gt;&gt; for p in mesh:</span>
<span class="sd">        ...     print p</span>
<span class="sd">        x1:0 | x2:0.5 | y1:0 | y2:1 | z1:0 | z2:3</span>
<span class="sd">        x1:0.5 | x2:1 | y1:0 | y2:1 | z1:0 | z2:3</span>
<span class="sd">        x1:0 | x2:0.5 | y1:1 | y2:2 | z1:0 | z2:3</span>
<span class="sd">        x1:0.5 | x2:1 | y1:1 | y2:2 | z1:0 | z2:3</span>
<span class="sd">        &gt;&gt;&gt; print mesh[0]</span>
<span class="sd">        x1:0 | x2:0.5 | y1:0 | y2:1 | z1:0 | z2:3</span>
<span class="sd">        &gt;&gt;&gt; print mesh[-1]</span>
<span class="sd">        x1:0.5 | x2:1 | y1:1 | y2:2 | z1:0 | z2:3</span>

<span class="sd">    One with physical properties::</span>

<span class="sd">        &gt;&gt;&gt; props = {&#39;density&#39;:[2670.0, 1000.0]}</span>
<span class="sd">        &gt;&gt;&gt; mesh = PrismMesh((0, 2, 0, 4, 0, 3), (1, 1, 2), props=props)</span>
<span class="sd">        &gt;&gt;&gt; for p in mesh:</span>
<span class="sd">        ...     print p</span>
<span class="sd">        x1:0 | x2:1 | y1:0 | y2:4 | z1:0 | z2:3 | density:2670</span>
<span class="sd">        x1:1 | x2:2 | y1:0 | y2:4 | z1:0 | z2:3 | density:1000</span>

<span class="sd">    or equivalently::</span>

<span class="sd">        &gt;&gt;&gt; mesh = PrismMesh((0, 2, 0, 4, 0, 3), (1, 1, 2))</span>
<span class="sd">        &gt;&gt;&gt; mesh.addprop(&#39;density&#39;, [200, -1000.0])</span>
<span class="sd">        &gt;&gt;&gt; for p in mesh:</span>
<span class="sd">        ...     print p</span>
<span class="sd">        x1:0 | x2:1 | y1:0 | y2:4 | z1:0 | z2:3 | density:200</span>
<span class="sd">        x1:1 | x2:2 | y1:0 | y2:4 | z1:0 | z2:3 | density:-1000</span>

<span class="sd">    You can use :meth:`~fatiando.mesher.PrismMesh.get_xs` (and similar</span>
<span class="sd">    methods for y and z) to get the x coordinates of the prisms in the mesh::</span>

<span class="sd">        &gt;&gt;&gt; mesh = PrismMesh((0, 2, 0, 4, 0, 3), (1, 1, 2))</span>
<span class="sd">        &gt;&gt;&gt; print mesh.get_xs()</span>
<span class="sd">        [ 0.  1.  2.]</span>
<span class="sd">        &gt;&gt;&gt; print mesh.get_ys()</span>
<span class="sd">        [ 0.  4.]</span>
<span class="sd">        &gt;&gt;&gt; print mesh.get_zs()</span>
<span class="sd">        [ 0.  3.]</span>

<span class="sd">    The ``shape`` of the mesh must be integer!</span>

<span class="sd">        &gt;&gt;&gt; mesh = PrismMesh((0, 2, 0, 4, 0, 3), (1, 1, 2.5))</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">            ...</span>
<span class="sd">        AttributeError: Invalid mesh shape (1, 1, 2.5). shape must be integers</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">celltype</span> <span class="o">=</span> <span class="n">Prism</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">nz</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="n">shape</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ny</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nz</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s1">&#39;Invalid mesh shape </span><span class="si">{}</span><span class="s1">. shape must be integers&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">shape</span><span class="p">)))</span>
        <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nx</span> <span class="o">*</span> <span class="n">ny</span> <span class="o">*</span> <span class="n">nz</span><span class="p">)</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span> <span class="o">=</span> <span class="n">bounds</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span><span class="o">/</span><span class="n">nx</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span><span class="o">/</span><span class="n">ny</span>
        <span class="n">dz</span> <span class="o">=</span> <span class="p">(</span><span class="n">z2</span> <span class="o">-</span> <span class="n">z1</span><span class="p">)</span><span class="o">/</span><span class="n">nz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="n">bounds</span>
        <span class="k">if</span> <span class="n">props</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">props</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">props</span> <span class="o">=</span> <span class="n">props</span>
        <span class="c1"># The index of the current prism in an iteration. Needed when mesh is</span>
        <span class="c1"># used as an iterator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># List of masked prisms. Will return None if trying to access them</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Wether or not to change heights to z coordinate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zdown</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="ow">or</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;mesh index out of range&#39;</span><span class="p">)</span>
        <span class="c1"># To walk backwards in the list</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="n">index</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">nz</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">index</span><span class="o">//</span><span class="p">(</span><span class="n">nx</span><span class="o">*</span><span class="n">ny</span><span class="p">)</span>
        <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">index</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">nx</span><span class="o">*</span><span class="n">ny</span><span class="p">))</span><span class="o">//</span><span class="n">nx</span>
        <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">index</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">nx</span><span class="o">*</span><span class="n">ny</span><span class="p">)</span> <span class="o">-</span> <span class="n">j</span><span class="o">*</span><span class="n">nx</span><span class="p">)</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">i</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">j</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">k</span>
        <span class="n">z2</span> <span class="o">=</span> <span class="n">z1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">index</span><span class="p">]]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">celltype</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="n">props</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>
        <span class="n">prism</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">prism</span>

<div class="viewcode-block" id="PrismMesh.addprop"><a class="viewcode-back" href="../../../api/fatiando.mesher.PrismMesh.html#fatiando.mesher.PrismMesh.addprop">[docs]</a>    <span class="k">def</span> <span class="nf">addprop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add physical property values to the cells in the mesh.</span>

<span class="sd">        Different physical properties of the mesh are stored in a dictionary.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        * prop : str</span>
<span class="sd">            Name of the physical property.</span>
<span class="sd">        * values :  list or array</span>
<span class="sd">            Value of this physical property in each prism of the mesh. For the</span>
<span class="sd">            ordering of prisms in the mesh see</span>
<span class="sd">            :class:`~fatiando.mesher.PrismMesh`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span></div>

<div class="viewcode-block" id="PrismMesh.carvetopo"><a class="viewcode-back" href="../../../api/fatiando.mesher.PrismMesh.html#fatiando.mesher.PrismMesh.carvetopo">[docs]</a>    <span class="k">def</span> <span class="nf">carvetopo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">below</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mask (remove) prisms from the mesh that are above the topography.</span>

<span class="sd">        Accessing the ith prism will return None if it was masked (above the</span>
<span class="sd">        topography).</span>
<span class="sd">        Also mask prisms outside of the topography grid provided.</span>
<span class="sd">        The topography height information does not need to be on a regular</span>
<span class="sd">        grid, it will be interpolated.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        * x, y : lists</span>
<span class="sd">            x and y coordinates of the grid points</span>
<span class="sd">        * height : list or array</span>
<span class="sd">            Array with the height of the topography</span>
<span class="sd">        * below : boolean</span>
<span class="sd">            Will mask prisms below the input surface if set to *True*.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nz</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span>
        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span>
        <span class="c1"># The coordinates of the centers of the cells</span>
        <span class="n">xc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dx</span>
        <span class="c1"># Sometimes arange returns more due to rounding</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">nx</span><span class="p">:</span>
            <span class="n">xc</span> <span class="o">=</span> <span class="n">xc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">yc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dy</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">yc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">ny</span><span class="p">:</span>
            <span class="n">yc</span> <span class="o">=</span> <span class="n">yc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">zc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">dz</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dz</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">zc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">nz</span><span class="p">:</span>
            <span class="n">zc</span> <span class="o">=</span> <span class="n">zc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">XC</span><span class="p">,</span> <span class="n">YC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xc</span><span class="p">,</span> <span class="n">yc</span><span class="p">)</span>
        <span class="n">topo</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">griddata</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">height</span><span class="p">,</span> <span class="p">(</span><span class="n">XC</span><span class="p">,</span> <span class="n">YC</span><span class="p">),</span>
                                          <span class="n">method</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zdown</span><span class="p">:</span>
            <span class="c1"># -1 if to transform height into z coordinate</span>
            <span class="n">topo</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">topo</span>
        <span class="c1"># griddata returns a masked array. If the interpolated point is out of</span>
        <span class="c1"># of the data range, mask will be True. Use this to remove all cells</span>
        <span class="c1"># below a masked topo point (ie, one with no height information)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">isMA</span><span class="p">(</span><span class="n">topo</span><span class="p">):</span>
            <span class="n">topo_mask</span> <span class="o">=</span> <span class="n">topo</span><span class="o">.</span><span class="n">mask</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">topo_mask</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">topo</span><span class="p">))]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">cellz</span> <span class="ow">in</span> <span class="n">zc</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">masked</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">topo</span><span class="p">,</span> <span class="n">topo_mask</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">below</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">masked</span> <span class="ow">or</span>
                            <span class="p">(</span><span class="n">cellz</span> <span class="o">&gt;</span> <span class="n">h</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">zdown</span><span class="p">)</span> <span class="ow">or</span>
                            <span class="p">(</span><span class="n">cellz</span> <span class="o">&lt;</span> <span class="n">h</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">zdown</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">masked</span> <span class="ow">or</span>
                            <span class="p">(</span><span class="n">cellz</span> <span class="o">&lt;</span> <span class="n">h</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">zdown</span><span class="p">)</span> <span class="ow">or</span>
                            <span class="p">(</span><span class="n">cellz</span> <span class="o">&gt;</span> <span class="n">h</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">zdown</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="PrismMesh.get_xs"><a class="viewcode-back" href="../../../api/fatiando.mesher.PrismMesh.html#fatiando.mesher.PrismMesh.get_xs">[docs]</a>    <span class="k">def</span> <span class="nf">get_xs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an array with the x coordinates of the prisms in mesh.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span>
        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span>
        <span class="n">nz</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xs</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="n">nx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">xs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">xs</span></div>

<div class="viewcode-block" id="PrismMesh.get_ys"><a class="viewcode-back" href="../../../api/fatiando.mesher.PrismMesh.html#fatiando.mesher.PrismMesh.get_ys">[docs]</a>    <span class="k">def</span> <span class="nf">get_ys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an array with the y coordinates of the prisms in mesh.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span>
        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span>
        <span class="n">nz</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">+</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ys</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="n">ny</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ys</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ys</span></div>

<div class="viewcode-block" id="PrismMesh.get_zs"><a class="viewcode-back" href="../../../api/fatiando.mesher.PrismMesh.html#fatiando.mesher.PrismMesh.get_zs">[docs]</a>    <span class="k">def</span> <span class="nf">get_zs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an array with the z coordinates of the prisms in mesh.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span>
        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span>
        <span class="n">nz</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">z1</span><span class="p">,</span> <span class="n">z2</span> <span class="o">+</span> <span class="n">dz</span><span class="p">,</span> <span class="n">dz</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">zs</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="n">nz</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">zs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">zs</span></div>

<div class="viewcode-block" id="PrismMesh.get_layer"><a class="viewcode-back" href="../../../api/fatiando.mesher.PrismMesh.html#fatiando.mesher.PrismMesh.get_layer">[docs]</a>    <span class="k">def</span> <span class="nf">get_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the set of prisms corresponding to the ith layer of the mesh.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        * i : int</span>
<span class="sd">            The index of the layer</span>

<span class="sd">        Returns:</span>

<span class="sd">        * prisms : list of :class:`~fatiando.mesher.Prism`</span>
<span class="sd">            The prisms in the ith layer</span>

<span class="sd">        Examples::</span>

<span class="sd">            &gt;&gt;&gt; mesh = PrismMesh((0, 2, 0, 2, 0, 2), (2, 2, 2))</span>
<span class="sd">            &gt;&gt;&gt; layer = mesh.get_layer(0)</span>
<span class="sd">            &gt;&gt;&gt; for p in layer:</span>
<span class="sd">            ...     print p</span>
<span class="sd">            x1:0 | x2:1 | y1:0 | y2:1 | z1:0 | z2:1</span>
<span class="sd">            x1:1 | x2:2 | y1:0 | y2:1 | z1:0 | z2:1</span>
<span class="sd">            x1:0 | x2:1 | y1:1 | y2:2 | z1:0 | z2:1</span>
<span class="sd">            x1:1 | x2:2 | y1:1 | y2:2 | z1:0 | z2:1</span>
<span class="sd">            &gt;&gt;&gt; layer = mesh.get_layer(1)</span>
<span class="sd">            &gt;&gt;&gt; for p in layer:</span>
<span class="sd">            ...     print p</span>
<span class="sd">            x1:0 | x2:1 | y1:0 | y2:1 | z1:1 | z2:2</span>
<span class="sd">            x1:1 | x2:2 | y1:0 | y2:1 | z1:1 | z2:2</span>
<span class="sd">            x1:0 | x2:1 | y1:1 | y2:2 | z1:1 | z2:2</span>
<span class="sd">            x1:1 | x2:2 | y1:1 | y2:2 | z1:1 | z2:2</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nz</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">nz</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Layer index </span><span class="si">%d</span><span class="s1"> is out of range.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">nx</span> <span class="o">*</span> <span class="n">ny</span>
        <span class="n">end</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nx</span> <span class="o">*</span> <span class="n">ny</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">layer</span></div>

<div class="viewcode-block" id="PrismMesh.layers"><a class="viewcode-back" href="../../../api/fatiando.mesher.PrismMesh.html#fatiando.mesher.PrismMesh.layers">[docs]</a>    <span class="k">def</span> <span class="nf">layers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an iterator over the layers of the mesh.</span>

<span class="sd">        Examples::</span>

<span class="sd">            &gt;&gt;&gt; mesh = PrismMesh((0, 2, 0, 2, 0, 2), (2, 2, 2))</span>
<span class="sd">            &gt;&gt;&gt; for layer in mesh.layers():</span>
<span class="sd">            ...     for p in layer:</span>
<span class="sd">            ...         print p</span>
<span class="sd">            x1:0 | x2:1 | y1:0 | y2:1 | z1:0 | z2:1</span>
<span class="sd">            x1:1 | x2:2 | y1:0 | y2:1 | z1:0 | z2:1</span>
<span class="sd">            x1:0 | x2:1 | y1:1 | y2:2 | z1:0 | z2:1</span>
<span class="sd">            x1:1 | x2:2 | y1:1 | y2:2 | z1:0 | z2:1</span>
<span class="sd">            x1:0 | x2:1 | y1:0 | y2:1 | z1:1 | z2:2</span>
<span class="sd">            x1:1 | x2:2 | y1:0 | y2:1 | z1:1 | z2:2</span>
<span class="sd">            x1:0 | x2:1 | y1:1 | y2:2 | z1:1 | z2:2</span>
<span class="sd">            x1:1 | x2:2 | y1:1 | y2:2 | z1:1 | z2:2</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nz</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nz</span><span class="p">):</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="n">i</span><span class="p">)</span></div>

<div class="viewcode-block" id="PrismMesh.dump"><a class="viewcode-back" href="../../../api/fatiando.mesher.PrismMesh.html#fatiando.mesher.PrismMesh.dump">[docs]</a>    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meshfile</span><span class="p">,</span> <span class="n">propfile</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dump the mesh to a file in the format required by UBC-GIF program</span>
<span class="sd">        MeshTools3D.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        * meshfile : str or file</span>
<span class="sd">            Output file to save the mesh. Can be a file name or an open file.</span>
<span class="sd">        * propfile : str or file</span>
<span class="sd">            Output file to save the physical properties *prop*. Can be a file</span>
<span class="sd">            name or an open file.</span>
<span class="sd">        * prop : str</span>
<span class="sd">            The name of the physical property in the mesh that will be saved to</span>
<span class="sd">            *propfile*.</span>

<span class="sd">        .. note:: Uses -10000000 as the dummy value for plotting topography</span>

<span class="sd">        Examples:</span>

<span class="sd">            &gt;&gt;&gt; from StringIO import StringIO</span>
<span class="sd">            &gt;&gt;&gt; meshfile = StringIO()</span>
<span class="sd">            &gt;&gt;&gt; densfile = StringIO()</span>
<span class="sd">            &gt;&gt;&gt; mesh = PrismMesh((0, 10, 0, 20, 0, 5), (1, 2, 2))</span>
<span class="sd">            &gt;&gt;&gt; mesh.addprop(&#39;density&#39;, [1, 2, 3, 4])</span>
<span class="sd">            &gt;&gt;&gt; mesh.dump(meshfile, densfile, &#39;density&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print meshfile.getvalue().strip()</span>
<span class="sd">            2 2 1</span>
<span class="sd">            0 0 0</span>
<span class="sd">            2*10</span>
<span class="sd">            2*5</span>
<span class="sd">            1*5</span>
<span class="sd">            &gt;&gt;&gt; print densfile.getvalue().strip()</span>
<span class="sd">            1.0000</span>
<span class="sd">            3.0000</span>
<span class="sd">            2.0000</span>
<span class="sd">            4.0000</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">prop</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;mesh doesn&#39;t have a &#39;</span><span class="si">%s</span><span class="s2">&#39; property.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prop</span><span class="p">))</span>
        <span class="n">isstr</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">meshfile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">isstr</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">meshfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">meshfile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">nz</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span>
        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span>
        <span class="n">meshfile</span><span class="o">.</span><span class="n">writelines</span><span class="p">([</span>
            <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">nz</span><span class="p">),</span>
            <span class="s2">&quot;</span><span class="si">%g</span><span class="s2"> </span><span class="si">%g</span><span class="s2"> </span><span class="si">%g</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="o">-</span><span class="n">z1</span><span class="p">),</span>
            <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">*</span><span class="si">%g</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ny</span><span class="p">,</span> <span class="n">dy</span><span class="p">),</span>
            <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">*</span><span class="si">%g</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">dx</span><span class="p">),</span>
            <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">*</span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nz</span><span class="p">,</span> <span class="n">dz</span><span class="p">)])</span>
        <span class="k">if</span> <span class="n">isstr</span><span class="p">:</span>
            <span class="n">meshfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromiter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="n">prop</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="c1"># Replace the masked cells with a dummy value</span>
        <span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10000000</span>
        <span class="n">reordered</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">propfile</span><span class="p">,</span> <span class="n">reordered</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.4f</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PrismMesh.copy"><a class="viewcode-back" href="../../../api/fatiando.mesher.PrismMesh.html#fatiando.mesher.PrismMesh.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a deep copy of the current instance.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cp</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TesseroidMesh"><a class="viewcode-back" href="../../../api/fatiando.mesher.TesseroidMesh.html#fatiando.mesher.TesseroidMesh">[docs]</a><span class="k">class</span> <span class="nc">TesseroidMesh</span><span class="p">(</span><span class="n">PrismMesh</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A 3D regular mesh of tesseroids.</span>

<span class="sd">    Tesseroids are ordered as follows: first layers (height coordinate),</span>
<span class="sd">    then N-S rows and finaly E-W.</span>

<span class="sd">    Ex: in a mesh with shape ``(3,3,3)`` the 15th element (index 14) has height</span>
<span class="sd">    index 1 (second layer), y index 1 (second row), and x index 2 (</span>
<span class="sd">    third element in the column).</span>

<span class="sd">    This class can used as list of tesseroids. It acts</span>
<span class="sd">    as an iteratior (so you can loop over tesseroids).</span>
<span class="sd">    It also has a ``__getitem__``</span>
<span class="sd">    method to access individual elements in the mesh.</span>
<span class="sd">    In practice, it should be able to be</span>
<span class="sd">    passed to any function that asks for a list of tesseroids, like</span>
<span class="sd">    :func:`fatiando.gravmag.tesseroid.gz`.</span>

<span class="sd">    To make the mesh incorporate a topography, use</span>
<span class="sd">    :meth:`~fatiando.mesher.TesseroidMesh.carvetopo`</span>

<span class="sd">    Parameters:</span>

<span class="sd">    * bounds : list = [w, e, s, n, top, bottom]</span>
<span class="sd">        Boundaries of the mesh. ``w, e, s, n`` in degrees, ``top`` and</span>
<span class="sd">        ``bottom`` are heights (positive upward) and in meters.</span>
<span class="sd">    * shape : tuple = (nr, nlat, nlon)</span>
<span class="sd">        Number of tesseroids in the radial, latitude, and longitude directions.</span>
<span class="sd">    * props :  dict</span>
<span class="sd">        Physical properties of each tesseroid in the mesh.</span>
<span class="sd">        Each key should be the name of a physical property. The corresponding</span>
<span class="sd">        value should be a list with the values of that particular property on</span>
<span class="sd">        each tesseroid of the mesh.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from fatiando.mesher import TesseroidMesh</span>
<span class="sd">        &gt;&gt;&gt; mesh = TesseroidMesh((0, 1, 0, 2, 3, 0), (1, 2, 2))</span>
<span class="sd">        &gt;&gt;&gt; for p in mesh:</span>
<span class="sd">        ...     print p</span>
<span class="sd">        w:0 | e:0.5 | s:0 | n:1 | top:3 | bottom:0</span>
<span class="sd">        w:0.5 | e:1 | s:0 | n:1 | top:3 | bottom:0</span>
<span class="sd">        w:0 | e:0.5 | s:1 | n:2 | top:3 | bottom:0</span>
<span class="sd">        w:0.5 | e:1 | s:1 | n:2 | top:3 | bottom:0</span>
<span class="sd">        &gt;&gt;&gt; print mesh[0]</span>
<span class="sd">        w:0 | e:0.5 | s:0 | n:1 | top:3 | bottom:0</span>
<span class="sd">        &gt;&gt;&gt; print mesh[-1]</span>
<span class="sd">        w:0.5 | e:1 | s:1 | n:2 | top:3 | bottom:0</span>

<span class="sd">    One with physical properties::</span>

<span class="sd">        &gt;&gt;&gt; props = {&#39;density&#39;:[2670.0, 1000.0]}</span>
<span class="sd">        &gt;&gt;&gt; mesh = TesseroidMesh((0, 2, 0, 4, 3, 0), (1, 1, 2), props=props)</span>
<span class="sd">        &gt;&gt;&gt; for p in mesh:</span>
<span class="sd">        ...     print p</span>
<span class="sd">        w:0 | e:1 | s:0 | n:4 | top:3 | bottom:0 | density:2670</span>
<span class="sd">        w:1 | e:2 | s:0 | n:4 | top:3 | bottom:0 | density:1000</span>

<span class="sd">    or equivalently::</span>

<span class="sd">        &gt;&gt;&gt; mesh = TesseroidMesh((0, 2, 0, 4, 3, 0), (1, 1, 2))</span>
<span class="sd">        &gt;&gt;&gt; mesh.addprop(&#39;density&#39;, [200, -1000.0])</span>
<span class="sd">        &gt;&gt;&gt; for p in mesh:</span>
<span class="sd">        ...     print p</span>
<span class="sd">        w:0 | e:1 | s:0 | n:4 | top:3 | bottom:0 | density:200</span>
<span class="sd">        w:1 | e:2 | s:0 | n:4 | top:3 | bottom:0 | density:-1000</span>

<span class="sd">    You can use :meth:`~fatiando.mesher.PrismMesh.get_xs` (and similar</span>
<span class="sd">    methods for y and z) to get the x coordinates of the tesseroidss in the</span>
<span class="sd">    mesh::</span>

<span class="sd">        &gt;&gt;&gt; mesh = TesseroidMesh((0, 2, 0, 4, 3, 0), (1, 1, 2))</span>
<span class="sd">        &gt;&gt;&gt; print mesh.get_xs()</span>
<span class="sd">        [ 0.  1.  2.]</span>
<span class="sd">        &gt;&gt;&gt; print mesh.get_ys()</span>
<span class="sd">        [ 0.  4.]</span>
<span class="sd">        &gt;&gt;&gt; print mesh.get_zs()</span>
<span class="sd">        [ 3.  0.]</span>

<span class="sd">    You can iterate over the layers of the mesh::</span>

<span class="sd">        &gt;&gt;&gt; mesh = TesseroidMesh((0, 2, 0, 2, 2, 0), (2, 2, 2))</span>
<span class="sd">        &gt;&gt;&gt; for layer in mesh.layers():</span>
<span class="sd">        ...     for p in layer:</span>
<span class="sd">        ...         print p</span>
<span class="sd">        w:0 | e:1 | s:0 | n:1 | top:2 | bottom:1</span>
<span class="sd">        w:1 | e:2 | s:0 | n:1 | top:2 | bottom:1</span>
<span class="sd">        w:0 | e:1 | s:1 | n:2 | top:2 | bottom:1</span>
<span class="sd">        w:1 | e:2 | s:1 | n:2 | top:2 | bottom:1</span>
<span class="sd">        w:0 | e:1 | s:0 | n:1 | top:1 | bottom:0</span>
<span class="sd">        w:1 | e:2 | s:0 | n:1 | top:1 | bottom:0</span>
<span class="sd">        w:0 | e:1 | s:1 | n:2 | top:1 | bottom:0</span>
<span class="sd">        w:1 | e:2 | s:1 | n:2 | top:1 | bottom:0</span>

<span class="sd">    The ``shape`` of the mesh must be integer!</span>

<span class="sd">        &gt;&gt;&gt; mesh = TesseroidMesh((0, 2, 0, 4, 0, 3), (1, 1, 2.5))</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">            ...</span>
<span class="sd">        AttributeError: Invalid mesh shape (1, 1, 2.5). shape must be integers</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">celltype</span> <span class="o">=</span> <span class="n">Tesseroid</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zdown</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump</span> <span class="o">=</span> <span class="kc">None</span></div>
</pre></div>
                </div>
                  
            </div>
        </div>

    


    <footer class="footer">
        <div class="container">
            <p class="pull-right">
                <a href="#">Back to top</a>
                
                    <br/>
                    
                
            </p>

            <p class="text-center">
                &copy; Copyright 2010-2018, Leonardo Uieda.
                Created using <a
                    href="http://sphinx-doc.org/">Sphinx</a> 1.6.7.
            </p>
        </div>
    </footer>


  </body>
</html>